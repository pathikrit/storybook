<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Create Story</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
<h1>Make Story</h1>
<form id="form">
    <label for="who">Who:</label>
    <input type="text" id="who" name="who" required>
    <label for="prompt">Prompt:</label>
    <textarea id="prompt" name="prompt" rows="4" required></textarea>
    <label><input type="checkbox" id="bedtime" name="bedtime">Bedtime?</label>
    <label><input type="checkbox" id="include_child" name="include_child">Include Child?</label>
    <label><input type="checkbox" id="generate_audio" name="generate_audio">Generate Audio?</label>
    <label><input type="checkbox" id="generate_images" name="generate_images">Generate Images?</label>
    <button type="submit" id="make_story_button">Make Story</button>
</form>

<div id="spinner" style="display:none;">Writing story...</div>

<div id="result" style="display:none;">
    <audio id="audio" controls style="display:none;"></audio>
    <div id="story"></div>
</div>

<script>
    $(document).ready(() => {
        $('#form').on('submit', (event) => {
            event.preventDefault();

            $('#spinner').show();
            $('#result').hide();

            const params = $.param({
                who: $('#who').val(),
                prompt: $('#prompt').val(),
                bedtime: $('#bedtime').is(':checked'),
                include_child: $('#include_child').is(':checked'),
                generate_audio: $('#generate_audio').is(':checked'),
                generate_images: $('#generate_images').is(':checked')
            });

            $.getJSON(`/story?${params}`)
                .done((res) => {
                    $('#spinner').hide();
                    $('#story').html(res.story);
                    if (res.audio_uri) {
                        $('#audio').attr('src', res.audio_uri).show();
                    } else {
                        $('#audio').hide();
                    }
                    $('#result').show()
                })
        });
    });
</script>
</body>
</html>
